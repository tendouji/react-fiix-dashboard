<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="icon" sizes="64x64" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="FiiX Dashboard created using create-react-app" />
    <link rel="apple-touch-icon" sizes="192x192" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.webmanifest" />
    <title>FiiX Dashboard</title>
</head>

<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-messaging.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-analytics.js"></script>
    
    <script src="./js/firebase-init.js"></script>
    <script>
    firebase.analytics();

    firebaseMessaging
        .requestPermission()
        .then(() => {
            console.log("Notification permission granted.");
            return firebaseMessaging.getToken()
        })
        .then((token) => {
            console.log("FCM registration token:", token);
        })
        .catch((err) => {
            console.log("Unable to get permission to notify.", err);
        });

    firebaseMessaging.onMessage((payload) => {
        const notificationData = handleFirebaseMessagePayload(payload);

        if(!!notificationData.title) {
            navigator.serviceWorker.getRegistrations().then(registration => {
                registration[0].showNotification(
                    notificationData.title, 
                    notificationData.options
                );
            });
        }
    });
    </script>
</body>

</html>